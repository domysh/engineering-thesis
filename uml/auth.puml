@startuml
actor Device
participant Server
collections "KeyStore" as KeyStore

Device -> Server: Connessione e invio del nome
Server -> KeyStore: Recupera chiave pubblica associata al nome del device
Server -> Server: Inizia processo di autenticazione challenge-response
Server -> Server: Genera token di autenticazione casuale
Server --> Device: Invia token al device

Device -> Device: Cifra token con chiave privata
Device --> Server: Invia token cifrato

Server -> Server: Decifra token con chiave pubblica
Server -> Server: Confronta token decifrato con token generato

alt Token corrisponde
    Server -> Device: Autenticazione riuscita
    Device -> Server: Inizia comunicazione
else Token non corrisponde
    Server -> Device: Autenticazione fallita
end
@enduml